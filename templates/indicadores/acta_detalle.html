{% extends "base.html" %}

{% block title %}Acta {{ acta.mes }}/{{ acta.anio }} - TransMaint{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- Header -->
    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
        <div class="flex items-center gap-4">
            <a href="{% url 'indicadores:actas' %}" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
                </svg>
            </a>
            <div>
                <h1 class="text-2xl font-bold text-gray-900 dark:text-white">
                    Acta de Seguimiento {{ acta.mes }}/{{ acta.anio }}
                </h1>
                <p class="text-gray-600 dark:text-gray-400">{{ acta.linea.codigo }} - {{ acta.linea.nombre }}</p>
            </div>
        </div>
        <div class="flex gap-2">
            {% if acta.url_acta_firmada %}
            <a href="{{ acta.url_acta_firmada }}" target="_blank"
               class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition flex items-center gap-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                </svg>
                Descargar Acta
            </a>
            {% endif %}
        </div>
    </div>

    <!-- Status Banner -->
    <div class="rounded-lg p-4
        {% if acta.estado == 'FIRMADA' %}bg-green-100 dark:bg-green-900/30 border border-green-300
        {% elif acta.estado == 'PENDIENTE_FIRMA' %}bg-yellow-100 dark:bg-yellow-900/30 border border-yellow-300
        {% else %}bg-blue-100 dark:bg-blue-900/30 border border-blue-300{% endif %}">
        <div class="flex items-center gap-3">
            <span class="font-medium
                {% if acta.estado == 'FIRMADA' %}text-green-800 dark:text-green-200
                {% elif acta.estado == 'PENDIENTE_FIRMA' %}text-yellow-800 dark:text-yellow-200
                {% else %}text-blue-800 dark:text-blue-200{% endif %}">
                Estado: {{ acta.get_estado_display }}
            </span>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Info Card -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
            <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Informacion de la Reunion</h2>
            <dl class="space-y-3">
                <div>
                    <dt class="text-sm text-gray-500 dark:text-gray-400">Periodo</dt>
                    <dd class="font-medium text-gray-900 dark:text-white">{{ acta.mes }}/{{ acta.anio }}</dd>
                </div>
                <div>
                    <dt class="text-sm text-gray-500 dark:text-gray-400">Linea</dt>
                    <dd>
                        <a href="{% url 'lineas:detalle' acta.linea.id %}" class="text-blue-600 hover:text-blue-800">
                            {{ acta.linea.codigo }} - {{ acta.linea.nombre }}
                        </a>
                    </dd>
                </div>
                <div>
                    <dt class="text-sm text-gray-500 dark:text-gray-400">Fecha de Reunion</dt>
                    <dd class="font-medium text-gray-900 dark:text-white">{{ acta.fecha_reunion|date:"d/m/Y" }}</dd>
                </div>
            </dl>
        </div>

        <!-- Attendees Card -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
            <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Asistentes</h2>
            <div class="space-y-4">
                <div>
                    <h3 class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-2">Instelec</h3>
                    {% if acta.asistentes_instelec %}
                    <p class="text-gray-600 dark:text-gray-300">{{ acta.asistentes_instelec|linebreaksbr }}</p>
                    {% else %}
                    <p class="text-gray-400">No registrado</p>
                    {% endif %}
                </div>
                <div>
                    <h3 class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-2">Cliente</h3>
                    {% if acta.asistentes_cliente %}
                    <p class="text-gray-600 dark:text-gray-300">{{ acta.asistentes_cliente|linebreaksbr }}</p>
                    {% else %}
                    <p class="text-gray-400">No registrado</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Indicators Summary -->
    {% if acta.resumen_indicadores %}
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
        <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Resumen de Indicadores</h2>
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                <thead>
                    <tr>
                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Indicador</th>
                        <th class="px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase">Valor</th>
                        <th class="px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase">Meta</th>
                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Estado</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
                    {% for key, data in acta.resumen_indicadores.items %}
                    <tr>
                        <td class="px-4 py-2 text-gray-900 dark:text-white">{{ data.nombre|default:key }}</td>
                        <td class="px-4 py-2 text-right text-gray-600 dark:text-gray-400">{{ data.valor }}</td>
                        <td class="px-4 py-2 text-right text-gray-600 dark:text-gray-400">{{ data.meta }}</td>
                        <td class="px-4 py-2">
                            {% if data.cumple %}
                            <span class="text-green-600">Cumple</span>
                            {% else %}
                            <span class="text-red-600">No Cumple</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}

    <!-- Commitments -->
    {% if acta.compromisos %}
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
        <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Compromisos</h2>
        <div class="prose dark:prose-invert max-w-none">
            {{ acta.compromisos|linebreaksbr }}
        </div>
    </div>
    {% endif %}

    <!-- Observations -->
    {% if acta.observaciones %}
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
        <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Observaciones</h2>
        <p class="text-gray-600 dark:text-gray-400">{{ acta.observaciones }}</p>
    </div>
    {% endif %}
</div>
{% endblock %}
